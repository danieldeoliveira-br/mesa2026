<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIV - Sistema de Votação Mesa Diretora 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media print {
            body * { visibility: hidden; }
            #tela-final, #tela-final * { visibility: visible; }
            #tela-final { position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <header class="bg-slate-900 text-white p-4 shadow-lg flex justify-between items-center z-10">
        <div class="flex items-center gap-4">
            <div class="bg-blue-600 w-12 h-12 rounded-lg flex items-center justify-center shadow-inner">
                <i class="fas fa-landmark text-2xl"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold tracking-tight">Câmara Municipal de Espumoso</h1>
                <p class="text-xs text-slate-400 uppercase tracking-widest">Eleição Mesa Diretora 2026</p>
            </div>
        </div>
        <div class="text-right">
            <div id="relogio" class="text-2xl font-mono font-bold text-blue-400">00:00:00</div>
            <div class="text-xs text-slate-500">Sessão Ordinária - 18/12/2025</div>
        </div>
    </header>

    <main class="flex-1 flex overflow-hidden">
        
        <section class="flex-1 p-6 overflow-y-auto flex flex-col relative w-3/4 transition-all duration-500" id="painel-principal">
            
            <div id="tela-votacao" class="animate-fade-in max-w-5xl mx-auto w-full">
                <div class="mb-6 flex justify-between items-end">
                    <div>
                        <span class="text-sm font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full uppercase tracking-wider mb-2 inline-block">Em Votação</span>
                        <h2 id="cargo-titulo" class="text-4xl font-black text-slate-800">CARGO</h2>
                        <p class="text-slate-500 mt-1 flex items-center gap-2">
                            <i class="fas fa-hand-pointer"></i> 
                            Abertura de Urna: Clique para computar cada cédula nominalmente
                        </p>
                    </div>
                    <div id="contador-votos" class="bg-slate-800 text-white text-lg font-bold px-6 py-2 rounded-full shadow-md transition-all">
                        Cédula 1 de 9
                    </div>
                </div>

                <div class="w-full bg-slate-200 h-2 rounded-full mb-8 overflow-hidden">
                    <div id="barra-progresso" class="bg-blue-600 h-full w-0 transition-all duration-300 ease-out"></div>
                </div>

                <div id="grid-candidatos" class="grid grid-cols-4 gap-4 mb-8">
                    </div>

                <div class="flex gap-4 border-t border-slate-200 pt-6">
                    <button onclick="registrarVoto('NULO')" class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold py-4 rounded-xl border border-slate-300 transition flex items-center justify-center gap-2">
                        <i class="fas fa-ban"></i> VOTO NULO / BRANCO
                    </button>
                    <button onclick="desfazerVoto()" class="px-6 bg-red-50 hover:bg-red-100 text-red-600 font-bold rounded-xl border border-red-200 transition" title="Desfazer último voto">
                        <i class="fas fa-undo"></i>
                    </button>
                </div>
            </div>

            <div id="tela-resultado" class="hidden absolute inset-0 bg-f1f5f9 flex items-center justify-center z-20">
                <div class="bg-white p-10 rounded-2xl shadow-2xl max-w-2xl w-full text-center border border-slate-200">
                    <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6 text-3xl shadow-sm">
                        <i class="fas fa-check"></i>
                    </div>
                    <h3 class="text-slate-400 text-sm font-bold uppercase tracking-widest mb-2">Eleito para o Cargo</h3>
                    <h2 id="res-nome" class="text-4xl font-black text-slate-800 mb-4">NOME DO ELEITO</h2>
                    <div class="bg-slate-50 rounded-lg p-4 mb-8 border border-slate-100">
                        <p class="text-slate-500 text-sm">Critério de Definição:</p>
                        <p id="res-motivo" class="font-bold text-slate-700">Maioria Simples</p>
                    </div>

                    <div id="area-detalhe-empate" class="hidden mb-6 text-left bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                        <h4 class="text-xs font-bold text-yellow-700 uppercase mb-2 border-b border-yellow-200 pb-1">Análise de Senioridade (Art. 33, §2º)</h4>
                        <div id="lista-desempate" class="space-y-1 text-sm"></div>
                    </div>

                    <button onclick="proximoCargo()" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-4 rounded-xl shadow-lg transition transform hover:scale-[1.02]">
                        Prosseguir para Próximo Cargo <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <div id="tela-final" class="hidden bg-white p-10 max-w-4xl mx-auto shadow-xl mt-10 min-h-screen">
                <div class="text-center border-b-2 border-black pb-6 mb-6">
                    <img src="brasao.jpg" alt="Brasão" class="mx-auto h-20 mb-4 opacity-50"> 
                    <h2 class="text-2xl font-bold uppercase">Estado do Rio Grande do Sul</h2>
                    <h3 class="text-xl font-bold uppercase">Câmara Municipal de Espumoso</h3>
                    <p class="mt-4 font-mono text-sm">Relatório Oficial de Apuração - Mesa Diretora 2026</p>
                    <p id="data-impressao" class="text-xs mt-1"></p>
                </div>
                
                <table class="w-full text-left border-collapse border border-black mb-10">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-black p-3 text-sm uppercase">Cargo</th>
                            <th class="border border-black p-3 text-sm uppercase">Vereador Eleito</th>
                            <th class="border border-black p-3 text-sm uppercase">Votos</th>
                            <th class="border border-black p-3 text-sm uppercase">Critério</th>
                        </tr>
                    </thead>
                    <tbody id="corpo-tabela-ata" class="font-mono text-sm">
                        </tbody>
                </table>

                <div class="mt-20 flex justify-center gap-20">
                    <div class="text-center border-t border-black pt-2 w-64">
                        <p class="font-bold text-sm">Presidente da Sessão</p>
                    </div>
                    <div class="text-center border-t border-black pt-2 w-64">
                        <p class="font-bold text-sm">Secretário</p>
                    </div>
                </div>

                <div class="mt-10 text-center no-print">
                    <button onclick="window.print()" class="bg-blue-600 text-white px-6 py-3 rounded font-bold shadow hover:bg-blue-700">
                        <i class="fas fa-print"></i> Imprimir Ata
                    </button>
                </div>
            </div>

        </section>

        <aside class="w-1/4 bg-white border-l border-slate-200 p-6 flex flex-col shadow-xl z-10">
            <div id="box-empate" class="hidden bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6 rounded shadow-sm animate-pulse">
                <div class="flex items-center gap-2 text-yellow-700 font-bold mb-1">
                    <i class="fas fa-exclamation-triangle"></i> Empate Detectado
                </div>
                <p class="text-xs text-yellow-600 leading-relaxed">
                    Se persistir, o sistema aplicará automaticamente o critério de idade (Art. 33, §2º).
                </p>
            </div>

            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Contagem em Tempo Real</h3>
            
            <div id="placar-lista" class="flex-1 overflow-y-auto pr-2">
                <p class="text-center text-slate-400 text-sm py-10 italic">Aguardando início...</p>
            </div>

            <div class="mt-6 pt-6 border-t border-slate-200">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Cargos Definidos</h3>
                <div id="historico-lista">
                    <p class="text-xs text-slate-300">Nenhum cargo definido ainda.</p>
                </div>
            </div>
        </aside>

    </main>

    <script>
        // =================================================================
        // MÓDULO DE DADOS E REGRAS REGIMENTAIS (Resolução nº 1/2022)
        // =================================================================

        const CARGOS = ["PRESIDENTE", "VICE-PRESIDENTE", "SECRETÁRIO GERAL", "SECRETÁRIO ADJUNTO"];

        // --- UNIVERSO DE VEREADORES (9 VOTOS TOTAIS) ---
        // Configuração:
        // cargo_atual: 1=Pres, 2=Vice, 3=Geral, 4=Adjunto, 0=Nenhum (Para fins de impedimento)
        // suplente: true (Inelegível Art. 39), false (Titular)
        
        const VEREADORES = [
            // --- GRUPO: SUPLENTE (INELEGÍVEL) ---
            {id: 9, nome: "Marina Camera (PL)", nasc: "1980-01-01", cargo_atual: 0, suplente: true}, 

            // --- GRUPO: TITULARES (POOL DE ELEGÍVEIS) ---
            // Leonardo Comin (RETORNO): Sem cargo na mesa atual, Titular. Plenamente elegível.
            // *ATENÇÃO*: Atualize a data de nascimento real dele se possível.
            {id: 8, nome: "Leonardo Comin (PP)", nasc: "1980-06-15", cargo_atual: 0, suplente: false}, 

            // Mesa Atual 2025 (Sujeitos a restrições)
            {id: 7, nome: "Tomas Fiuza (PP)", nasc: "1989-10-17", cargo_atual: 1, suplente: false}, // Pres
            {id: 6, nome: "Paulo Flores (PDT)", nasc: "1969-05-18", cargo_atual: 2, suplente: false}, // Vice
            {id: 2, nome: "Denner Senhor (PL)", nasc: "1983-02-26", cargo_atual: 3, suplente: false}, // Geral
            {id: 1, nome: "Dayana Soares (PDT)", nasc: "1979-06-08", cargo_atual: 4, suplente: false}, // Adj

            // Demais Titulares (Livres)
            {id: 3, nome: "Eduardo Signor (UB)", nasc: "1994-12-23", cargo_atual: 0, suplente: false},
            {id: 4, nome: "Fabiana Otoni (PP)", nasc: "1982-02-12", cargo_atual: 0, suplente: false},
            {id: 5, nome: "Leandro Colleraus (PDT)", nasc: "1979-03-05", cargo_atual: 0, suplente: false}
        ];
        
        let estado = { indiceCargo: 0, votos: [], resultados: [] };

        // --- MOTOR DE ELEGIBILIDADE (OS 3 FILTROS CIENTÍFICOS) ---
        function isElegivel(vereador, indiceCargoDisputa) {
            // Mapeamento: indiceCargoDisputa (0..3) para Hierarquia Legal (1..4)
            const hierarquiaDisputa = indiceCargoDisputa + 1; 

            // 1. FILTRO DE EXCLUSÃO LÓGICA (Já eleito na sessão atual)
            const jaEleito = estado.resultados.some(r => r.vencedor === vereador.nome);
            if (jaEleito) return false;

            // 2. FILTRO DE SUPLÊNCIA (Art. 39) - O "Não-Ser" político
            if (vereador.suplente === true) return false;

            // Se o vereador é "tabula rasa" (não tem cargo na mesa atual), é elegível (salvo se já eleito hoje)
            if (vereador.cargo_atual === 0) return true;

            // 3. FILTRO DE REELEIÇÃO (Art. 34, §1º - Parte A) - Bloqueio Horizontal
            if (vereador.cargo_atual === hierarquiaDisputa) return false;

            // 4. FILTRO DE DESCENSO (Art. 34, §1º - Parte B) - Bloqueio Vertical Descendente
            // Nota: No RI, quanto maior o número hierárquico, "inferior" é o cargo (1 é topo).
            // Se o cargo que ele quer (ex: 3) é maior que o que ele tem (ex: 2), ele está descendo. Proibido.
            if (hierarquiaDisputa > vereador.cargo_atual) return false;

            return true;
        }

        // --- UTILITÁRIOS DE DATA (CRITÉRIO DE DESEMPATE) ---
        function formatarData(s) { const [a,m,d] = s.split('-'); return `${d}/${m}/${a}`; }
        // Menor timestamp = Mais velho = Vence
        function calcularDiasVida(s) { return new Date(s).getTime(); } 
        function calcularIdadeTexto(s) {
            const hj = new Date(); const ns = new Date(s);
            let an = hj.getFullYear() - ns.getFullYear();
            const m = hj.getMonth() - ns.getMonth();
            if (m < 0 || (m===0 && hj.getDate() < ns.getDate())) an--;
            return `${an} anos`;
        }

        // --- LÓGICA DA APLICAÇÃO ---
        function iniciar() {
            setInterval(() => document.getElementById('relogio').innerText = new Date().toLocaleTimeString('pt-BR'), 1000);
            carregarCargo();
        }

        function carregarCargo() {
            estado.votos = [];
            document.getElementById('tela-votacao').classList.remove('hidden');
            document.getElementById('tela-resultado').classList.add('hidden');
            document.getElementById('box-empate').classList.add('hidden');
            
            const nomeCargo = CARGOS[estado.indiceCargo];
            document.getElementById('cargo-titulo').innerText = nomeCargo;
            
            // Texto adaptado para votação nominal (abertura de urna)
            document.querySelector('.fa-hand-pointer').parentNode.innerText = 
                ` Abertura de Urna: Clique para computar cada voto apurado para ${nomeCargo}`;

            atualizarUI();
            gerarBotoes();
        }

        function gerarBotoes() {
            const grid = document.getElementById('grid-candidatos');
            grid.innerHTML = '';
            
            const candidatosElegiveis = VEREADORES.filter(v => isElegivel(v, estado.indiceCargo));
            
            candidatosElegiveis.forEach(v => {
                const btn = document.createElement('button');
                btn.className = "bg-white hover:bg-blue-50 hover:border-blue-600 border-2 border-slate-200 p-4 rounded-xl flex flex-col items-center justify-center shadow-sm hover:shadow-md transition group h-32 relative overflow-hidden";
                btn.onclick = () => registrarVoto(v);
                
                const ini = v.nome.split(' ').slice(0, 2).map(n=>n[0]).join('');
                
                btn.innerHTML = `
                    <div class="w-10 h-10 rounded-full bg-slate-100 text-slate-600 font-bold flex items-center justify-center mb-2 group-hover:bg-blue-600 group-hover:text-white transition z-10">${ini}</div>
                    <div class="font-bold text-slate-800 text-sm text-center leading-tight group-hover:text-blue-700 z-10 relative">${v.nome.split('(')[0]}</div>
                    <div class="text-[10px] text-slate-400 mt-1 z-10">${v.nome.match(/\((.*?)\)/)[1]}</div>
                `;
                grid.appendChild(btn);
            });

            if (candidatosElegiveis.length === 0) {
                grid.innerHTML = '<div class="col-span-4 text-center text-red-500 font-bold p-10 bg-red-50 rounded border border-red-200">Impasse Regimental: Nenhum candidato elegível.</div>';
            }
        }

        function registrarVoto(c) {
            if (estado.votos.length >= 9) return; // Trava no quórum máximo
            
            const voto = c === 'NULO' ? { nome: "NULO / BRANCO", id: 0, nasc: "9999-12-31" } : c;
            estado.votos.push(voto);
            
            atualizarUI();
            
            if (estado.votos.length === 9) {
                setTimeout(processarResultado, 500); // Auto-processamento ao fechar 9 votos
            }
        }

        function desfazerVoto() {
            if (estado.votos.length > 0) { estado.votos.pop(); atualizarUI(); }
        }

        function atualizarUI() {
            const total = 9; 
            const atual = estado.votos.length; 
            const pct = (atual / total) * 100;
            
            document.getElementById('barra-progresso').style.width = `${pct}%`;
            
            const contador = document.getElementById('contador-votos');
            if (atual < 9) {
                contador.innerText = `Cédula ${atual + 1} de 9`;
                contador.className = "inline-block bg-slate-800 text-white text-lg font-bold px-6 py-2 rounded-full shadow-md";
            } else {
                contador.innerText = "Computando...";
                contador.className = "inline-block bg-green-600 text-white text-lg font-bold px-6 py-2 rounded-full animate-pulse shadow-md";
            }

            // Lógica do Dashboard Lateral
            const lista = document.getElementById('placar-lista'); 
            lista.innerHTML = '';
            
            const contagem = {}; 
            estado.votos.forEach(v => contagem[v.nome] = (contagem[v.nome]||0)+1);
            const ord = Object.entries(contagem).sort((a,b) => b[1] - a[1]);

            // Alerta de Empate
            const boxEmpate = document.getElementById('box-empate');
            if (ord.length > 1 && ord[0][1] === ord[1][1]) boxEmpate.classList.remove('hidden');
            else boxEmpate.classList.add('hidden');

            if (ord.length === 0) { 
                lista.innerHTML = '<p class="text-center text-slate-400 text-sm py-10 italic">Aguardando votos...</p>'; 
                return; 
            }

            ord.forEach(([nm, qtd]) => {
                const p = (qtd/9)*100; 
                const isLider = qtd === ord[0][1];
                lista.innerHTML += `
                    <div class="mb-3 animate-fade-in">
                        <div class="flex justify-between items-end mb-1">
                            <span class="text-xs font-bold ${isLider?'text-blue-700':'text-slate-500'} truncate pr-2">${nm}</span>
                            <span class="text-xl font-black ${isLider?'text-blue-800':'text-slate-400'}">${qtd}</span>
                        </div>
                        <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                            <div class="h-full ${isLider?'bg-blue-600':'bg-slate-300'} transition-all duration-300" style="width: ${p}%"></div>
                        </div>
                    </div>`;
            });
        }

        function processarResultado() {
            const contagem = {}; 
            const mapa = {};
            
            // Agrega votos e mantém referência aos objetos (para pegar data de nascimento)
            estado.votos.forEach(v => { 
                contagem[v.nome] = (contagem[v.nome]||0)+1; 
                mapa[v.nome] = v; 
            });
            
            const ord = Object.entries(contagem).sort((a,b) => b[1] - a[1]);
            const prim = ord[0]; 
            const emp = ord.filter(i => i[1] === prim[1]);

            let venc = "", mot = "", htmlD = "";

            if (emp.length === 1) {
                // Vitória por Maioria
                venc = prim[0]; 
                mot = "Maioria Simples dos Votos";
                document.getElementById('area-detalhe-empate').classList.add('hidden');
            } else {
                // Empate - Resolver por Senioridade
                const cEmp = emp.filter(e => e[0] !== "NULO / BRANCO").map(e => mapa[e[0]]);
                
                if (cEmp.length === 0) { 
                    venc = "NENHUM"; mot = "Empate de Nulos"; 
                } else {
                    // Ordenação por Idade (timestamp menor = mais velho)
                    cEmp.sort((a, b) => calcularDiasVida(a.nasc) - calcularDiasVida(b.nasc));
                    
                    venc = cEmp[0].nome; 
                    mot = "Critério de Desempate: Maior Idade (Art. 33, §2º)";
                    
                    htmlD = cEmp.map((c, i) => `
                        <div class="flex justify-between items-center border-b border-yellow-200 last:border-0 py-2 ${i===0?'text-green-700 font-bold bg-white/50 px-2 rounded':'text-slate-500 px-2'}">
                            <span>${i+1}º ${c.nome}</span>
                            <span class="text-sm font-mono">${calcularIdadeTexto(c.nasc)} - ${formatarData(c.nasc)}</span>
                        </div>`).join('');
                    
                    const area = document.getElementById('area-detalhe-empate');
                    document.getElementById('lista-desempate').innerHTML = htmlD; 
                    area.classList.remove('hidden');
                }
            }

            estado.resultados.push({ cargo: CARGOS[estado.indiceCargo], vencedor: venc, votos: prim[1], motivo: mot });
            
            document.getElementById('tela-votacao').classList.add('hidden');
            document.getElementById('tela-resultado').classList.remove('hidden');
            document.getElementById('res-nome').innerText = venc;
            document.getElementById('res-motivo').innerText = mot;
            
            atualizarHistorico();
        }

        function atualizarHistorico() {
            const div = document.getElementById('historico-lista');
            if (estado.resultados.length === 0) return;
            div.innerHTML = '';
            estado.resultados.forEach(res => {
                div.innerHTML += `
                    <div class="bg-white p-3 rounded-lg border-l-4 border-green-500 shadow-sm mb-2 animate-fade-in">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">${res.cargo}</p>
                        <p class="font-bold text-slate-800 text-sm leading-tight">${res.vencedor}</p>
                        <div class="flex justify-between items-center mt-1">
                            <span class="text-xs text-slate-500 bg-slate-100 px-2 rounded">${res.votos} votos</span>
                        </div>
                    </div>`;
            });
        }

        function proximoCargo() {
            estado.indiceCargo++;
            if (estado.indiceCargo < CARGOS.length) {
                carregarCargo();
            } else {
                gerarRelatorioFinal();
            }
        }

        function gerarRelatorioFinal() {
            document.getElementById('tela-resultado').classList.add('hidden');
            document.getElementById('tela-final').classList.remove('hidden');
            document.querySelector('aside').classList.add('hidden');
            const m = document.getElementById('painel-principal'); 
            m.classList.remove('w-3/4'); 
            m.classList.add('w-full');

            document.getElementById('data-impressao').innerText = `Sessão Ordinária de 18/12/2025 - Emitido às ${new Date().toLocaleTimeString()}`;
            const tbody = document.getElementById('corpo-tabela-ata');
            tbody.innerHTML = '';

            estado.resultados.forEach(res => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="border border-black p-3">${res.cargo}</td>
                    <td class="border border-black p-3 font-bold">${res.vencedor}</td>
                    <td class="border border-black p-3">${res.votos}</td>
                    <td class="border border-black p-3">${res.motivo}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Boot
        iniciar();
    </script>
</body>
</html>